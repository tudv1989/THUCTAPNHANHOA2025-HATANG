### 1. M√°y ·∫£o trong KVM ƒë∆∞·ª£c l∆∞u ·ªü ƒë√¢u?
M√°y ·∫£o (VM) trong KVM th∆∞·ªùng ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i c√°c th∆∞ m·ª•c m·∫∑c ƒë·ªãnh sau:
- /var/lib/libvirt/images/: Th∆∞ m·ª•c ch·ª©a file disk (·ªï ƒëƒ©a ·∫£o) c·ªßa VM (VD: ubuntu.qcow2, centos.raw).
- /etc/libvirt/qemu/: Th∆∞ m·ª•c ch·ª©a file c·∫•u h√¨nh XML c·ªßa VM (VD: ubuntu.xml).
- /var/log/libvirt/qemu/: Th∆∞ m·ª•c ch·ª©a log c·ªßa VM (VD: ubuntu.log).

> üí° L∆∞u √Ω: C√°c th∆∞ m·ª•c n√†y c√≥ th·ªÉ thay ƒë·ªïi t√πy theo c·∫•u h√¨nh h·ªá th·ªëng ho·∫∑c ng∆∞·ªùi d√πng ch·ªâ ƒë·ªãnh.

---

### 2. C·∫•u tr√∫c th∆∞ m·ª•c v√† c√°c file c·ªßa m√°y ·∫£o
M·ªói VM trong KVM c√≥ c√°c file ch√≠nh sau:

#### ‚ë† File disk (·ªï ƒëƒ©a ·∫£o)
- V·ªã tr√≠: /var/lib/libvirt/images/<t√™n-VM>.<ƒë·ªãnh-d·∫°ng>  
  - V√≠ d·ª•:  
   
    /var/lib/libvirt/images/ubuntu.qcow2
    /var/lib/libvirt/images/centos.raw
    
- ƒê·ªãnh d·∫°ng ph·ªï bi·∫øn:  
  - qcow2 (h·ªó tr·ª£ snapshot, n√©n d·ªØ li·ªáu).  
  - raw (hi·ªáu su·∫•t cao, kh√¥ng n√©n).  
  - vmdk, vdi (d√πng cho VirtualBox).  

#### ‚ë° File c·∫•u h√¨nh XML
- V·ªã tr√≠: /etc/libvirt/qemu/<t√™n-VM>.xml  
  - V√≠ d·ª•:  
   
    /etc/libvirt/qemu/ubuntu.xml
    
- N·ªôi dung:  
  - Khai b√°o th√¥ng s·ªë VM (CPU, RAM, disk, network, GPU passthrough...).  
  - V√≠ d·ª• ƒëo·∫°n c·∫•u h√¨nh:  
   
    <domain type='kvm'>
      <name>ubuntu</name>
      <memory unit='GiB'>4</memory>
      <disk type='file' device='disk'>
        <source file='/var/lib/libvirt/images/ubuntu.qcow2'/>
      </disk>
    </domain>
    
#### ‚ë¢ File log
- V·ªã tr√≠: /var/log/libvirt/qemu/<t√™n-VM>.log  
  - V√≠ d·ª•:  
   
    /var/log/libvirt/qemu/ubuntu.log
    
- C√¥ng d·ª•ng:  
  - Ghi l·∫°i qu√° tr√¨nh kh·ªüi ƒë·ªông, l·ªói, c·∫£nh b√°o c·ªßa VM.  
  - H·ªØu √≠ch ƒë·ªÉ debug khi VM kh√¥ng ho·∫°t ƒë·ªông.  

#### ‚ë£ File snapshot (n·∫øu c√≥)
- V·ªã tr√≠: /var/lib/libvirt/qemu/snapshot/<t√™n-VM>/  
  - V√≠ d·ª•:  
   
    /var/lib/libvirt/qemu/snapshot/ubuntu/snapshot1.xml
    
- ƒê·ªãnh d·∫°ng:  
  - File XML m√¥ t·∫£ tr·∫°ng th√°i snapshot (RAM, disk).  
  - File disk snapshot (VD: ubuntu.snap).  

---

### 3. Chi ti·∫øt th√¥ng tin trong t·ª´ng file
#### File disk (qcow2/raw)
- Ki·ªÉm tra th√¥ng tin:  
 
  qemu-img info /var/lib/libvirt/images/ubuntu.qcow2
  
  - Output m·∫´u:  
   
    file format: qcow2  
    virtual size: 20G (21474836480 bytes)  
    disk size: 5.3G  # Dung l∆∞·ª£ng th·ª±c chi·∫øm tr√™n host  
    
#### File c·∫•u h√¨nh XML
- Xem n·ªôi dung:  
 
  virsh dumpxml ubuntu  # Ho·∫∑c m·ªü file /etc/libvirt/qemu/ubuntu.xml
  
  - C√°c section quan tr·ªçng:  
    - <cpu>: C·∫•u h√¨nh CPU.  
    - <memory>: RAM.  
    - <disk>: ƒê∆∞·ªùng d·∫´n file disk.  
    - <interface>: C·∫•u h√¨nh m·∫°ng (NAT/bridge).  

#### File log
- Xem log real-time:  
 
  tail -f /var/log/libvirt/qemu/ubuntu.log
  
  - Ph√¢n t√≠ch l·ªói ph·ªï bi·∫øn:  
    - Could not open disk image: L·ªói ƒë∆∞·ªùng d·∫´n file disk.  
    - Failed to start VM: Thi·∫øu quy·ªÅn ho·∫∑c xung ƒë·ªôt t√†i nguy√™n.  

---

### 4. V√≠ d·ª• th·ª±c t·∫ø
#### Danh s√°ch file c·ªßa VM "ubuntu"
/var/lib/libvirt/images/

‚îî‚îÄ‚îÄ ubuntu.qcow2          # Disk ·∫£o (20GB qcow2)

/etc/libvirt/qemu/

‚îî‚îÄ‚îÄ ubuntu.xml            # C·∫•u h√¨nh VM

/var/log/libvirt/qemu/

‚îî‚îÄ‚îÄ ubuntu.log            # Log ho·∫°t ƒë·ªông
#### C√°ch backup VM
1. Sao l∆∞u file disk:  
  
   cp /var/lib/libvirt/images/ubuntu.qcow2 /backup/
   
2. Sao l∆∞u c·∫•u h√¨nh XML:  
  
   virsh dumpxml ubuntu > /backup/ubuntu.xml
   
---

### T√≥m t·∫Øt
- File disk: L∆∞u t·∫°i /var/lib/libvirt/images/ (qcow2/raw).  
- File c·∫•u h√¨nh: XML t·∫°i /etc/libvirt/qemu/.  
- File log: Theo d√µi t·∫°i /var/log/libvirt/qemu/.  
- Snapshot: L∆∞u tr·∫°ng th√°i VM d∆∞·ªõi d·∫°ng XML + disk delta.  

> üìå L·ªánh h·ªØu √≠ch:  
> - virsh list --all: Li·ªát k√™ t·∫•t c·∫£ VM.  
> - virsh edit <t√™n-VM>: Ch·ªânh s·ª≠a c·∫•u h√¨nh XML.  
> - qemu-img resize: Thay ƒë·ªïi k√≠ch th∆∞·ªõc disk ·∫£o.