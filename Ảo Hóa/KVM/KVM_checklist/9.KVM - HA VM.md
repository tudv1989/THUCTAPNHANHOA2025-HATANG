## Mình sẽ trình bày diễn giải chi tiết

#### 1. Dưới đây là các bước tạo cụm KVM HA và connect storage cụm đến cụm Ceph:

#### 2.Tạo một cặp khóa SSH mới không có mật khẩu và lưu chúng vào thư mục ``/root/.ssh``.

Trên ``kvmnode137`` chạy lệnh sau: 

```Bash
rm -rf ~/.ssh/*
ssh-keygen -t rsa -b 4096 -N "" -f  /root/.ssh/id_rsa -q
```

#### 3. Tiếp theo, tạo một file cấu hình SSH mới trong ``~/.ssh/config`` với thông tin về cách kết nối đến các node trong cụm Ceph.

```Bash
cat > ~/.ssh/config << 'OEF'
Host kvmnode137
    Hostname kvmnode137.dinhtu.xyz 
    User root
Host kvmnode138
    Hostname kvmnode138.dinhtu.xyz 
    User root
Host kvmnode139
    Hostname kvmnode139.dinhtu.xyz 
    User root
OEF

```

#### 4. Phần tiếp theo tạo một file ``/etc/hosts`` mới với các địa chỉ IP và tên máy chủ cho cụm Ceph. Lưu ý đối với giao tiếp giữa các Node các bạn nên sử dụng IP Private của mỗi Node, đây là IP có băng thông cao sử dụng cho kết nối các cluster trong cụm ví dụ như dưới.

```Bash

cat >> /etc/hosts << 'OEF'
10.10.88.134 kvmnode137.dinhtu.xyz kvmnode137
10.10.88.135 kvmnode138.dinhtu.xyz kvmnode138
10.10.88.136 kvmnode139.dinhtu.xyz kvmnode139
OEF
```

#### 5. Sao chép khóa công khai SSH đến node còn lại trong cụm.

Sử dụng lệnh ``ssh-copy-id`` sao chép khóa công khai SSH đến node trong trong cụm, tính luôn cả ``cephnode221``, ví dụ của mình là ``cephnode222`` và ``cephnode223``.

```Bash
ssh-copy-id -o StrictHostKeychecking=no kvmnode137
ssh-copy-id -o StrictHostKeychecking=no kvmnode138
ssh-copy-id -o StrictHostKeychecking=no kvmnode139

```

Tùy chọn ``-o StrictHostKeychecking=no`` ngăn chặn việc kiểm tra dấu vân tay của máy chủ, cho phép kết nối tự động.

Dưới đây là ví dụ đầu ra khi chạy lệnh trên ở một node bất kỳ sẽ tương tự như dưới.

Nhập mật khẩu của root Node Remote để thực hiện việc sao chép.

Dưới đây là một đoạn shell sử dụng for để cài đặt Ceph trên mỗi node trong cụm.

```Bash

for NODE in kvmnode137 kvmnode138 kvmnode139
do
    ssh -o StrictHostKeychecking=no $NODE "apt update; apt -y install ceph"
done 

```