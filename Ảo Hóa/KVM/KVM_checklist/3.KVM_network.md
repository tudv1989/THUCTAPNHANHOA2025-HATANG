### CÃ¡c cháº¿ Ä‘á»™ card máº¡ng trong KVM 
 
KVM há»— trá»£ nhiá»u cháº¿ Ä‘á»™ card máº¡ng áº£o (virtual network interfaces) Ä‘á»ƒ káº¿t ná»‘i mÃ¡y áº£o (VM) vá»›i máº¡ng váº­t lÃ½ hoáº·c máº¡ng áº£o ná»™i bá»™. DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c cháº¿ Ä‘á»™ phá»• biáº¿n vÃ  Ä‘áº·c Ä‘iá»ƒm cá»§a tá»«ng loáº¡i:  

---

## 1. Cháº¿ Ä‘á»™ NAT (Network Address Translation) 
 
- Äáº·c Ä‘iá»ƒm:  
  - VM sá»­ dá»¥ng Ä‘á»‹a chá»‰ IP tá»« má»™t dáº£i riÃªng do KVM cung cáº¥p (thÆ°á»ng 192.168.122.0/24).  
  - KVM host Ä‘Ã³ng vai trÃ² gateway NAT, giÃºp VM ra Internet nhÆ°ng áº©n IP tháº­t.  
  - MÃ¡y ngoÃ i máº¡ng khÃ´ng thá»ƒ káº¿t ná»‘i trá»±c tiáº¿p vÃ o VM (trá»« khi cáº¥u hÃ¬nh port forwarding).  
- Æ¯u Ä‘iá»ƒm:  
  - An toÃ n, phÃ¹ há»£p cho cÃ¡c VM khÃ´ng cáº§n public IP.  
  - Dá»… triá»ƒn khai, khÃ´ng cáº§n cáº¥u hÃ¬nh phá»©c táº¡p.  
- NhÆ°á»£c Ä‘iá»ƒm:  
  - KhÃ´ng phÃ¹ há»£p cho server cáº§n public IP (VD: web server).  
- Cáº¥u hÃ¬nh máº·c Ä‘á»‹nh:  
 
  virsh net-list --all  # Hiá»ƒn thá»‹ máº¡ng máº·c Ä‘á»‹nh (thÆ°á»ng lÃ  'default' dÃ¹ng NAT)
  
---

## 2. Cháº¿ Ä‘á»™ Bridge (Bridge Networking)  

- Äáº·c Ä‘iá»ƒm:  
  - VM káº¿t ná»‘i trá»±c tiáº¿p vÃ o máº¡ng váº­t lÃ½ nhÆ° má»™t thiáº¿t bá»‹ Ä‘á»™c láº­p.  
  - VM nháº­n IP tá»« DHCP váº­t lÃ½ (hoáº·c cáº¥u hÃ¬nh tÄ©nh) vÃ  cÃ³ thá»ƒ ping Ä‘Æ°á»£c tá»« máº¡ng ngoÃ i.  
  - PhÃ¹ há»£p cho mÃ¡y chá»§ cáº§n public IP (VPS, web server).  
- Æ¯u Ä‘iá»ƒm:  
  - Hiá»‡u suáº¥t cao, Ä‘á»™ trá»… tháº¥p.  
  - VM cÃ³ thá»ƒ giao tiáº¿p trá»±c tiáº¿p vá»›i cÃ¡c thiáº¿t bá»‹ khÃ¡c trong máº¡ng LAN.  
- NhÆ°á»£c Ä‘iá»ƒm:  
  - Cáº§n cáº¥u hÃ¬nh bridge trÃªn host (phá»©c táº¡p hÆ¡n NAT).  
  - VM dá»… bá»‹ táº¥n cÃ´ng náº¿u khÃ´ng cÃ³ firewall.  
- Cáº¥u hÃ¬nh:  
 
  # Táº¡o bridge trÃªn host (VD: br0)
  ip link add name br0 type bridge
  ip link set br0 up
  ip link set eth0 master br0  # GÃ¡n card váº­t lÃ½ vÃ o bridge
  
---

## 3. Cháº¿ Ä‘á»™ Host-only (Private Network)  

- Äáº·c Ä‘iá»ƒm:  
  - CÃ¡c VM káº¿t ná»‘i vá»›i nhau vÃ  host trong má»™t máº¡ng áº£o riÃªng, khÃ´ng ra Internet.  
  - PhÃ¹ há»£p cho mÃ´i trÆ°á»ng lab, testing (VD: mÃ¡y áº£o database chá»‰ giao tiáº¿p ná»™i bá»™).  
- Æ¯u Ä‘iá»ƒm:  
  - CÃ´ láº­p hoÃ n toÃ n vá»›i máº¡ng bÃªn ngoÃ i, báº£o máº­t cao.  
- NhÆ°á»£c Ä‘iá»ƒm:  
  - VM khÃ´ng thá»ƒ truy cáº­p Internet.  
- Cáº¥u hÃ¬nh:  
 
  virsh net-define /tmp/hostonly.xml  # Táº¡o máº¡ng host-only
  virsh net-start hostonly
  
---

## 4. Cháº¿ Ä‘á»™ MACVTAP/Passthrough  

- Äáº·c Ä‘iá»ƒm:  
  - GÃ¡n trá»±c tiáº¿p MAC address cá»§a VM vÃ o card máº¡ng váº­t lÃ½, bá» qua lá»›p bridge.  
  - Hiá»‡u suáº¥t cá»±c cao, phÃ¹ há»£p cho á»©ng dá»¥ng cáº§n bÄƒng thÃ´ng lá»›n (VD: VoIP, streaming).  
- Æ¯u Ä‘iá»ƒm:  
  - Giáº£m Ä‘á»™ trá»…, táº­n dá»¥ng tá»‘i Ä‘a bÄƒng thÃ´ng váº­t lÃ½.  
- NhÆ°á»£c Ä‘iá»ƒm:  
  - KhÃ´ng há»— trá»£ má»™t sá»‘ tÃ­nh nÄƒng máº¡ng áº£o (VD: DHCP, firewall).  
  - Phá»©c táº¡p khi triá»ƒn khai.  
- Cáº¥u hÃ¬nh:  
 
  <interface type='direct'>
    <source dev='eth0' mode='passthrough'/>
  </interface>
  
---

## 5. Cháº¿ Ä‘á»™ SR-IOV (Single Root I/O Virtualization)  

- Äáº·c Ä‘iá»ƒm:  
  - Card máº¡ng váº­t lÃ½ há»— trá»£ SR-IOV (Intel 82599, Mellanox) Ä‘Æ°á»£c chia thÃ nh nhiá»u Virtual Functions (VF).  
  - Má»—i VM nháº­n má»™t VF riÃªng, hoáº¡t Ä‘á»™ng nhÆ° card máº¡ng váº­t lÃ½ Ä‘á»™c láº­p.  
  - Hiá»‡u suáº¥t gáº§n báº±ng bare-metal, Ä‘á»™ trá»… cá»±c tháº¥p.  
- Æ¯u Ä‘iá»ƒm:  
  - PhÃ¹ há»£p cho high-performance networking (VD: NFV, telecom).  
- NhÆ°á»£c Ä‘iá»ƒm:  
  - YÃªu cáº§u pháº§n cá»©ng Ä‘áº·c biá»‡t.  
  - KhÃ³ debug khi gáº·p lá»—i.  
- Cáº¥u hÃ¬nh:  
 
    lspci | grep -i ethernet  # Kiá»ƒm tra card há»— trá»£ SR-IOV
    echo 8 > /sys/class/net/eth0/device/sriov_numvfs  # Táº¡o 8 VFs
  
---

### TÃ³m táº¯t so sÃ¡nh  

| Cháº¿ Ä‘á»™       | Káº¿t ná»‘i ra Internet | Giao tiáº¿p vá»›i Host | Giao tiáº¿p vá»›i LAN | Hiá»‡u suáº¥t | PhÃ¹ há»£p                |
|------------------|-----------------------|-----------------------|----------------------|--------------|---------------------------|
| NAT         | CÃ³ (qua host)         | CÃ³                    | KhÃ´ng                | Trung bÃ¬nh   | VM cÃ¡ nhÃ¢n, dev           |
| Bridge      | CÃ³ (trá»±c tiáº¿p)        | CÃ³                    | CÃ³                   | Cao          | Server public (VPS, web)  |

Äinh TÃº, [4/21/2025 11:06 AM]
| Host-only   | KhÃ´ng                 | CÃ³                    | KhÃ´ng                | Tháº¥p         | Lab ná»™i bá»™                |
| MACVTAP     | CÃ³ (tÃ¹y cáº¥u hÃ¬nh)     | KhÃ´ng                 | CÃ³                   | Ráº¥t cao      | á»¨ng dá»¥ng real-time        |
| SR-IOV      | CÃ³ (trá»±c tiáº¿p)        | KhÃ´ng                 | CÃ³                   | Cá»±c cao      | High-performance network  |

### Lá»±a chá»n cháº¿ Ä‘á»™ phÃ¹ há»£p  

- NAT: DÃ nh cho VM cÃ¡ nhÃ¢n khÃ´ng cáº§n public IP.  
- Bridge: PhÃ¹ há»£p cho VPS, web server cáº§n káº¿t ná»‘i trá»±c tiáº¿p ra Internet.  
- Host-only: DÃ¹ng cho máº¡ng ná»™i bá»™ (VD: database, testing).  
- MACVTAP/SR-IOV: á»¨ng dá»¥ng Ä‘Ã²i há»i hiá»‡u suáº¥t máº¡ng cao (VD: game server, VoIP).  

> ğŸ’¡ Tip: Kiá»ƒm tra card máº¡ng hiá»‡n cÃ³ trÃªn KVM báº±ng lá»‡nh:  
>
> virsh domiflist <tÃªn-VM>
>