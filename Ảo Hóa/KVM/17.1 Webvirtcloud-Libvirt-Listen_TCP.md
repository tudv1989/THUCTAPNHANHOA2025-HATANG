Khi cài đặt xong Libvirtd , mình thấy Libvirtd lắng nghe dạng Unix-socket
Vì vậy để add KVM node vào WebvirtCloud bằng TCP, chúng ta sẽ chuyển đổi Libvirt lắng
nghe qua TCP cổng mặc định 16509

```Bash

root@tudv-kvm:/backup# systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
     Loaded: loaded (/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2025-04-25 00:18:56 +07; 10s ago
TriggeredBy: ● libvirtd-ro.socket
             ● libvirtd.socket
             ● libvirtd-admin.socket
       Docs: man:libvirtd(8)
             https://libvirt.org
   Main PID: 18196 (libvirtd)
      Tasks: 27 (limit: 32768)
     Memory: 66.6M
        CPU: 1.522s
     CGroup: /system.slice/libvirtd.service
             ├─ 1710 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/li>
             ├─ 1711 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/li>
             └─18196 /usr/sbin/libvirtd

Apr 25 00:18:56 tudv-kvm systemd[1]: Starting Virtualization daemon...
Apr 25 00:18:56 tudv-kvm systemd[1]: Started Virtualization daemon.
Apr 25 00:18:57 tudv-kvm dnsmasq[1710]: read /etc/hosts - 8 names
Apr 25 00:18:57 tudv-kvm dnsmasq[1710]: read /var/lib/libvirt/dnsmasq/default.addnhosts - 0 names
Apr 25 00:18:57 tudv-kvm dnsmasq-dhcp[1710]: read /var/lib/libvirt/dnsmasq/default.hostsfile

root@tudv-kvm:/backup# systemctl list-sockets | grep libvirt
/run/libvirt/libvirt-admin-sock                                                                     libvirtd-admin.socket                                                                                        libvirtd.service
/run/libvirt/libvirt-sock                                                                           libvirtd.socket                                                                                              libvirtd.service
/run/libvirt/libvirt-sock-ro                                                                        libvirtd-ro.socket                                                                                           libvirtd.service
/run/libvirt/virtlockd-admin-sock                                                                   virtlockd-admin.socket                                                                                       virtlockd.service
/run/libvirt/virtlockd-sock                                                                         virtlockd.socket                                                                                             virtlockd.service
/run/libvirt/virtlogd-admin-sock                                                                    virtlogd-admin.socket                                                                                        virtlogd.service
/run/libvirt/virtlogd-sock 
                                                                                                    virtlogd.socket                                                                                              virtlogd.service
root@tudv-kvm:/backup# systemctl cat libvirtd.socket
# /lib/systemd/system/libvirtd.socket
[Unit]
Description=Libvirt local socket
Before=libvirtd.service

[Socket]
# The directory must match the /etc/libvirt/libvirtd.conf unix_sock_dir setting
# when using systemd version < 227
ListenStream=/run/libvirt/libvirt-sock
Service=libvirtd.service
SocketMode=0660
SocketUser=root
SocketGroup=libvirt

[Install]
WantedBy=sockets.target

```

## Cách xử lý như sau:

#### 1. Đảm bảo ``/etc/libvirt/libvirtd.conf`` được cấu hình đúng để lắng nghe TCP 16509

    listen_tls = 0
    listen_tcp = 1
    tcp_port = "16509"
    listen_addr = "0.0.0.0"
    auth_tcp = "none"

#### 2. Chỉnh sửa hoặc tạo file override cho unit socket libvirtd.socket để vô hiệu hóa lắng nghe Unix socket 

(tùy chọn nhưng nên thực hiện nếu bạn chỉ muốn dùng TCP):

Nếu bạn muốn chỉ libvirtd lắng nghe trên TCP và không còn trên Unix socket, bạn có thể vô hiệu hóa việc lắng nghe Unix socket trong cấu hình systemd.

    mkdir -p /etc/systemd/system/libvirtd.socket.d
    nano /etc/systemd/system/libvirtd.socket.d/no-unix.conf

Thêm nội dung sau vào file no-unix.conf:

[Socket]
ListenStream=


Khởi động lại daemon

systemctl daemon-reload


