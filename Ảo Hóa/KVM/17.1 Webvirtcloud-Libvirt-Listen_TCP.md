Khi cài đặt xong Libvirtd , mình thấy Libvirtd lắng nghe dạng Unix-socket
Vì vậy để add KVM node vào WebvirtCloud bằng TCP, chúng ta sẽ chuyển đổi Libvirt lắng
nghe qua TCP cổng mặc định 16509

```Bash

root@tudv-kvm:/backup# systemctl status libvirtd.service
● libvirtd.service - Virtualization daemon
     Loaded: loaded (/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2025-04-25 00:18:56 +07; 10s ago
TriggeredBy: ● libvirtd-ro.socket
             ● libvirtd.socket
             ● libvirtd-admin.socket
       Docs: man:libvirtd(8)
             https://libvirt.org
   Main PID: 18196 (libvirtd)
      Tasks: 27 (limit: 32768)
     Memory: 66.6M
        CPU: 1.522s
     CGroup: /system.slice/libvirtd.service
             ├─ 1710 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/li>
             ├─ 1711 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/li>
             └─18196 /usr/sbin/libvirtd

Apr 25 00:18:56 tudv-kvm systemd[1]: Starting Virtualization daemon...
Apr 25 00:18:56 tudv-kvm systemd[1]: Started Virtualization daemon.
Apr 25 00:18:57 tudv-kvm dnsmasq[1710]: read /etc/hosts - 8 names
Apr 25 00:18:57 tudv-kvm dnsmasq[1710]: read /var/lib/libvirt/dnsmasq/default.addnhosts - 0 names
Apr 25 00:18:57 tudv-kvm dnsmasq-dhcp[1710]: read /var/lib/libvirt/dnsmasq/default.hostsfile

root@tudv-kvm:/backup# systemctl list-sockets | grep libvirt
/run/libvirt/libvirt-admin-sock                                                                     libvirtd-admin.socket                                                                                        libvirtd.service
/run/libvirt/libvirt-sock                                                                           libvirtd.socket                                                                                              libvirtd.service
/run/libvirt/libvirt-sock-ro                                                                        libvirtd-ro.socket                                                                                           libvirtd.service
/run/libvirt/virtlockd-admin-sock                                                                   virtlockd-admin.socket                                                                                       virtlockd.service
/run/libvirt/virtlockd-sock                                                                         virtlockd.socket                                                                                             virtlockd.service
/run/libvirt/virtlogd-admin-sock                                                                    virtlogd-admin.socket                                                                                        virtlogd.service
/run/libvirt/virtlogd-sock 
                                                                                                    virtlogd.socket                                                                                              virtlogd.service
root@tudv-kvm:/backup# systemctl cat libvirtd.socket
# /lib/systemd/system/libvirtd.socket
[Unit]
Description=Libvirt local socket
Before=libvirtd.service

[Socket]
# The directory must match the /etc/libvirt/libvirtd.conf unix_sock_dir setting
# when using systemd version < 227
ListenStream=/run/libvirt/libvirt-sock
Service=libvirtd.service
SocketMode=0660
SocketUser=root
SocketGroup=libvirt

[Install]
WantedBy=sockets.target


## Cách xử lý như sau:

#### 1. Đảm bảo ``/etc/libvirt/libvirtd.conf`` được cấu hình đúng để lắng nghe TCP 16509

    listen_tls = 0
    listen_tcp = 1
    tcp_port = "16509"
    listen_addr = "0.0.0.0"
    auth_tcp = "none"


root@kvmnode201:~# service libvirtd stop

root@kvmnode201:~# service libvirtd status
○ libvirtd.service - Virtualization daemon
     Loaded: loaded (/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)
     Active: inactive (dead) since Fri 2025-04-25 14:57:52 UTC; 35s ago
TriggeredBy: ● libvirtd.socket
       Docs: man:libvirtd(8)
             https://libvirt.org
    Process: 3169 ExecStart=/usr/sbin/libvirtd $LIBVIRTD_ARGS (code=exited, status=0/SUCCESS)
   Main PID: 3169 (code=exited, status=0/SUCCESS)
      Tasks: 2 (limit: 32768)



root@kvmnode201:~# cat /usr/lib/systemd/system/libvirtd-tcp.socket
[Unit]
Description=Libvirt non-TLS IP socket
Before=libvirtd.service
BindsTo=libvirtd.socket
After=libvirtd.socket


[Socket]
# This must match the /etc/libvirt/libvirtd.conf tcp_port setting
# when using systemd version < 227
ListenStream=16509
Service=libvirtd.service

[Install]
WantedBy=sockets.target


root@kvmnode201:~# systemctl start libvirtd-tcp.socket

root@kvmnode201:~# systemctl enable libvirtd-tcp.socket

root@kvmnode201:~# systemctl status libvirtd-tcp.socket
● libvirtd-tcp.socket - Libvirt non-TLS IP socket
     Loaded: loaded (/lib/systemd/system/libvirtd-tcp.socket; disabled; vendor preset: enabled)
     Active: active (listening) since Fri 2025-04-25 14:59:20 UTC; 8s ago
   Triggers: ● libvirtd.service
     Listen: [::]:16509 (Stream)
      Tasks: 0 (limit: 4562)
     Memory: 4.0K
        CPU: 2ms
     CGroup: /system.slice/libvirtd-tcp.socket


Apr 25 14:59:20 kvmnode201.dinhtu.xyz systemd[1]: Listening on Libvirt non-TLS IP socket.
root@kvmnode201:~# netstat -tupln
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      1103/python
tcp        0      0 127.0.0.1:6012          0.0.0.0:*               LISTEN      3261/sshd: root@pts
tcp        0      0 127.0.0.1:6010          0.0.0.0:*               LISTEN      901/sshd: root@pts/
tcp        0      0 127.0.0.1:6011          0.0.0.0:*               LISTEN      1630/sshd: root@pts
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      958/dnsmasq
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      762/nginx: master p
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      824/sshd: /usr/sbin
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      661/systemd-resolve
tcp        0      0 0.0.0.0:6080            0.0.0.0:*               LISTEN      1101/python3
tcp        0      0 0.0.0.0:6081            0.0.0.0:*               LISTEN      1102/python3
tcp6       0      0 :::9090                 :::*                    LISTEN      1/init
tcp6       0      0 :::16509                :::*                    LISTEN      1/init
tcp6       0      0 :::22                   :::*                    LISTEN      824/sshd: /usr/sbin
tcp6       0      0 ::1:6011                :::*                    LISTEN      1630/sshd: root@pts
tcp6       0      0 ::1:6010                :::*                    LISTEN      901/sshd: root@pts/
tcp6       0      0 ::1:6012                :::*                    LISTEN      3261/sshd: root@pts
udp        0      0 192.168.122.1:53        0.0.0.0:*                           958/dnsmasq
udp        0      0 127.0.0.53:53           0.0.0.0:*                           661/systemd-resolve
udp        0      0 0.0.0.0:67              0.0.0.0:*                           958/dnsmasq

root@kvmnode201:~# service libvirtd status
○ libvirtd.service - Virtualization daemon
     Loaded: loaded (/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)
     Active: inactive (dead) since Fri 2025-04-25 14:57:52 UTC; 1min 49s ago
TriggeredBy: ● libvirtd-tcp.socket
             ● libvirtd.socket
       Docs: man:libvirtd(8)
             https://libvirt.org
    Process: 3169 ExecStart=/usr/sbin/libvirtd $LIBVIRTD_ARGS (code=exited, status=0/SUCCESS)
   Main PID: 3169 (code=exited, status=0/SUCCESS)
      Tasks: 2 (limit: 32768)
     Memory: 60.4M
        CPU: 1.051s
     CGroup: /system.slice/libvirtd.service
             ├─958 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/lib/>
             └─959 /usr/sbin/dnsmasq --conf-file=/var/lib/libvirt/dnsmasq/default.conf --leasefile-ro --dhcp-script=/usr/lib/>


root@kvmnode201:~# service libvirtd start

```
