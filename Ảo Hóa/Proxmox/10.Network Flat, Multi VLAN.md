## 1. Network Flat (Mạng phẳng)

#### Khái niệm:

Network Flat là mô hình mạng đơn giản nhất, trong đó tất cả các máy ảo (VMs) và container chia sẻ cùng một mạng LAN vật lý.
Trong Proxmox, điều này thường được thực hiện bằng cách sử dụng một bridge (cầu nối) kết nối các VMs/containers với một interface mạng vật lý.
Tất cả các VMs/containers sẽ nằm trong cùng một broadcast domain, nghĩa là chúng có thể giao tiếp trực tiếp với nhau mà không cần router.

#### Ưu điểm:

Đơn giản, dễ cấu hình.
Hiệu suất cao, độ trễ thấp.
Phù hợp cho các môi trường nhỏ hoặc các ứng dụng không yêu cầu phân đoạn mạng phức tạp.

#### Nhược điểm:

Bảo mật kém, vì tất cả các thiết bị đều nằm trong cùng một mạng.
Khả năng mở rộng hạn chế, vì lưu lượng broadcast có thể gây tắc nghẽn mạng.
Khó quản lý khi số lượng VMs/containers tăng lên.

Trong Proxmox:

Khi bạn tạo một bridge (ví dụ: vmbr0) và gán một interface mạng vật lý vào bridge đó, bạn đã tạo một Network Flat.
Tất cả các VMs/containers kết nối với bridge này sẽ nằm trong cùng một mạng LAN.

## 2. Multi VLAN (Nhiều VLAN)

#### Khái niệm:

Multi VLAN cho phép bạn chia một mạng LAN vật lý thành nhiều mạng LAN logic riêng biệt (VLANs).
Mỗi VLAN hoạt động như một mạng LAN độc lập, có broadcast domain riêng.
Các VMs/containers trong các VLAN khác nhau không thể giao tiếp trực tiếp với nhau, trừ khi có router.

#### Ưu điểm:

Tăng cường bảo mật bằng cách cô lập các mạng khác nhau.
Cải thiện hiệu suất bằng cách giảm lưu lượng broadcast.
Quản lý linh hoạt hơn, cho phép phân đoạn mạng theo chức năng hoặc phòng ban.
Khả năng mở rộng tốt hơn.

#### Nhược điểm:

Cấu hình phức tạp hơn.
Yêu cầu switch mạng hỗ trợ VLAN tagging (802.1Q).

Trong Proxmox:

Để sử dụng Multi VLAN, bạn cần cấu hình VLAN tagging trên switch mạng vật lý.
Sau đó, bạn có thể tạo các bridge VLAN trong Proxmox bằng cách chỉ định VLAN ID (ví dụ: vmbr10 cho VLAN 10, vmbr20 cho VLAN 20).
Các VMs/containers kết nối với bridge VLAN sẽ được gán vào VLAN tương ứng.
Proxmox hỗ trợ cấu hình VLAN thông qua việc thêm 1 thẻ VLAN ID vào trong cấu hình của Bridge Network.

Ví dụ:

Bạn có thể tạo VLAN 10 cho mạng quản lý, VLAN 20 cho mạng máy chủ web và VLAN 30 cho mạng máy chủ cơ sở dữ liệu.
Điều này giúp cô lập các mạng khác nhau, tăng cường bảo mật và cải thiện hiệu suất.

Tóm lại:

Network Flat là mô hình mạng đơn giản, phù hợp cho các môi trường nhỏ.
Multi VLAN là mô hình mạng phức tạp hơn, nhưng cung cấp nhiều lợi ích về bảo mật, hiệu suất và khả năng mở rộng.
Tùy thuộc vào yêu cầu của ứng dụng và môi trường, bạn có thể chọn mô hình mạng phù hợp.

## Cách cấu hình Network Flat và Multi VLAN trong ảo hóa Proxmox:

#### Network Flat:

Trong Proxmox, mặc định sẽ có một mạng ảo (virtual network) tên là ``vmbr0`` được tạo ra.
Để cấu hình Network Flat, chỉ cần gán các máy ảo/container vào "vmbr0" như một mạng chung.

Các bước cấu hình:

  + Trong Proxmox Web UI, vào ``Network`` -> ``Bridges`` và chọn ``vmbr0``.
  + Trong tab ``General``, đảm bảo ``Type`` được chọn là ``Bridge``.
  + Trong tab ``Ports``, không cần thêm bất kỳ cổng nào, vì ``vmbr0`` sẽ là mạng chung.
  + Lưu cấu hình.

Khi tạo hoặc chỉnh sửa máy ảo/container, chọn ``vmbr0`` làm mạng ảo cho chúng.

#### Multi VLAN:

Để cấu hình Multi VLAN, bạn cần tạo các mạng ảo (virtual network) riêng biệt và gán chúng vào các VLAN khác nhau.

Các bước cấu hình:

  + Trong Proxmox Web UI, vào ``Network`` -> ``Bridges`` và chọn ``Create Bridge``.
  + Đặt tên cho bridge, ví dụ: ``vmbr1``, ``vmbr2``, ...
  + Trong tab ``General``, chọn "Type" là ``Bridge`` và nhập ID VLAN tương ứng (ví dụ: VLAN 10 cho ``vmbr1``, VLAN 20 cho ``vmbr2``, ...).
  + Trong tab ``Ports``, không cần thêm bất kỳ cổng nào, vì các máy ảo/container sẽ được gán vào các bridge này.
  + Lưu cấu hình.

Khi tạo hoặc chỉnh sửa máy ảo/container, chọn mạng ảo tương ứng (vmbr1, vmbr2, ...) để gán chúng vào các VLAN khác nhau.

## Mình dựng thêm pFsense với vai trò DHCP server để test Multi VLAN

